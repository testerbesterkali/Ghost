(()=>{"use strict";function e(e){return e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toString()}document.addEventListener("DOMContentLoaded",async()=>{const t=document.getElementById("enableToggle"),n=document.getElementById("eventsReceived"),o=document.getElementById("eventsProcessed"),d=document.getElementById("eventsSent"),s=document.getElementById("bufferSize"),a=document.getElementById("status"),c=document.getElementById("saveConfig"),i=document.getElementById("flushBtn"),m=document.getElementById("endpoint"),r=document.getElementById("apiKey"),u=document.getElementById("orgId"),l=await chrome.storage.local.get(["ghost_config","ghost_enabled"]),g=l.ghost_config||{};t.checked=!1!==l.ghost_enabled,m.value=g.endpoint||"",r.value=g.apiKey||"",u.value=g.orgId||"";const E=()=>{chrome.runtime.sendMessage({type:"GET_STATS"},t=>{if(chrome.runtime.lastError||!t)return;n.textContent=e(t.totalEventsReceived||0),o.textContent=e(t.totalEventsProcessed||0),d.textContent=e(t.transmitterStats?.totalSent||0),s.textContent=e(t.transmitterStats?.bufferSize||0);const c=t.isEnabled;a.textContent=c?"Active":"Paused",a.className="stat-value status-badge"+(c?"":" inactive")})};E(),setInterval(E,1e3),t.addEventListener("change",()=>{chrome.runtime.sendMessage({type:"TOGGLE_ENABLED",enabled:t.checked})}),c.addEventListener("click",()=>{const e={endpoint:m.value.trim(),apiKey:r.value.trim(),orgId:u.value.trim()};chrome.runtime.sendMessage({type:"UPDATE_CONFIG",config:e}),c.textContent="✓ Saved",c.style.background="#22c55e",setTimeout(()=>{c.textContent="Save",c.style.background=""},1500)}),i.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"FORCE_FLUSH"},()=>{i.textContent="✓ Flushed",setTimeout(()=>{i.textContent="Flush Now"},1500)})})})})();